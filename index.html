<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Random Number Drill</title>
    <style>
      :root {
        --bg: #0b0e14;
        --fg: #f2f2f2;
        --muted: #a0a3ac;
        --accent: #4ade80;
        --accent2: #60a5fa;
        --danger: #fb7185;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, 'Helvetica Neue', Arial, 'Noto Sans';
      }
      .wrap {
        display: grid;
        grid-template-rows: auto 1fr auto;
        min-height: 100%;
        gap: 16px;
        transition: grid-template-rows 0.3s ease;
      }
      .wrap.menu-hidden {
        grid-template-rows: 1fr auto;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        border-bottom: 1px solid #1b2230;
      }
      header.hidden {
        display: none;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }
      .controls label {
        font-size: 12px;
        color: var(--muted);
      }
      .controls input,
      .controls select {
        background: #121722;
        border: 1px solid #222a3a;
        color: var(--fg);
        padding: 6px 8px;
        border-radius: 10px;
        font-size: 14px;
        outline: none;
      }
      .controls input[type='number'] {
        width: 72px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 1px solid #222a3a;
        background: #121722;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }

      main {
        display: grid;
        place-items: center;
        padding: 16px;
      }
      .number {
        font-size: clamp(96px, 18vw, 320px);
        font-weight: 800;
        letter-spacing: -0.04em;
        line-height: 0.9;
        transition: color 0.2s ease;
      }
      .number.dim {
        color: #2a2f3c;
      }
      @keyframes pop {
        0% {
          transform: scale(0.92);
          opacity: 0.6;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      .number.change {
        animation: pop 150ms ease-out;
      }

      footer {
        padding: 12px 16px;
        border-top: 1px solid #1b2230;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        flex-wrap: wrap;
      }
      .btn {
        appearance: none;
        background: #121722;
        border: 1px solid #222a3a;
        color: var(--fg);
        padding: 10px 14px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
      }
      .btn.primary {
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        border: none;
        color: #0b0e14;
      }
      .btn.stop {
        background: var(--danger);
        border: none;
        color: #0b0e14;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div class="wrap" id="wrapper">
      <header id="header">
        <div class="controls">
          <span class="pill"
            >Range
            <label
              >min
              <input id="min" type="number" value="1" min="-9999" max="999999"
            /></label>
            <label
              >max
              <input id="max" type="number" value="4" min="-9999" max="999999"
            /></label>
          </span>
          <span class="pill"
            >Interval (sec)
            <input id="interval" type="number" value="5" min="0.5" step="0.5" />
          </span>
          <label class="pill"
            ><input id="noRepeat" type="checkbox" checked /> no immediate
            repeat</label
          >
          <label class="pill"><input id="audio" type="checkbox" /> beep</label>
          <label class="pill"
            ><input id="fullscreen" type="checkbox" /> fullscreen</label
          >
        </div>
      </header>

      <main>
        <div id="display" class="number dim">â€”</div>
      </main>

      <footer>
        <div class="row">
          <button id="startBtn" class="btn primary">Start</button>
          <button id="stopBtn" class="btn stop" disabled>Stop</button>
          <button id="toggleMenu" class="btn">Hide menu</button>
        </div>
        <div class="row">
          <button id="bigger" class="btn" title="Increase size">A+</button>
          <button id="smaller" class="btn" title="Decrease size">A-</button>
        </div>
      </footer>
    </div>

    <script>
      const el = {
        min: document.getElementById('min'),
        max: document.getElementById('max'),
        interval: document.getElementById('interval'),
        noRepeat: document.getElementById('noRepeat'),
        audio: document.getElementById('audio'),
        fullscreen: document.getElementById('fullscreen'),
        display: document.getElementById('display'),
        startBtn: document.getElementById('startBtn'),
        stopBtn: document.getElementById('stopBtn'),
        bigger: document.getElementById('bigger'),
        smaller: document.getElementById('smaller'),
        toggleMenu: document.getElementById('toggleMenu'),
        header: document.getElementById('header'),
        wrapper: document.getElementById('wrapper'),
      };

      let timer = null;
      let last = null;
      const COLORS = ['#ef4444', '#22c55e', '#3b82f6', '#eab308'];
      let lastColor = null;
      let fontScale = 1;

      function clamp(n, lo, hi) {
        return Math.min(hi, Math.max(lo, n));
      }
      function randInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        if (max < min) [min, max] = [max, min];
        if (min === max) return min;
        let r;
        do {
          r = Math.floor(Math.random() * (max - min + 1)) + min;
        } while (el.noRepeat.checked && max > min && r === last);
        last = r;
        return r;
      }

      function beep() {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = 'square';
          o.frequency.setValueAtTime(880, ctx.currentTime);
          g.gain.setValueAtTime(0.0001, ctx.currentTime);
          g.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.15);
          o.connect(g).connect(ctx.destination);
          o.start();
          o.stop(ctx.currentTime + 0.16);
        } catch (e) {}
      }

      function show(n) {
        let color;
        do {
          color = COLORS[Math.floor(Math.random() * COLORS.length)];
        } while (color === lastColor && COLORS.length > 1);
        lastColor = color;

        el.display.style.color = color;
        el.display.textContent = n;
        el.display.classList.remove('dim');
        el.display.classList.remove('change');
        void el.display.offsetWidth;
        el.display.classList.add('change');
        if (el.audio.checked) beep();
      }

      function tick() {
        const v = randInt(Number(el.min.value), Number(el.max.value));
        show(v);
      }

      async function toggleFullscreen(on) {
        if (!on) {
          if (document.fullscreenElement) await document.exitFullscreen();
          return;
        }
        const root = document.documentElement;
        if (!document.fullscreenElement && root.requestFullscreen) {
          try {
            await root.requestFullscreen();
          } catch (e) {}
        }
      }

      function start() {
        const sec = clamp(Number(el.interval.value) || 5, 0.25, 3600);
        el.interval.value = sec;
        el.startBtn.disabled = true;
        el.stopBtn.disabled = false;
        tick();
        timer = setInterval(tick, sec * 1000);
        if (el.fullscreen.checked) toggleFullscreen(true);
      }

      function stop() {
        clearInterval(timer);
        timer = null;
        el.startBtn.disabled = false;
        el.stopBtn.disabled = true;
        el.display.classList.add('dim');
        toggleFullscreen(false);
      }

      el.startBtn.addEventListener('click', start);
      el.stopBtn.addEventListener('click', stop);

      el.bigger.addEventListener('click', () => {
        fontScale = clamp(fontScale + 0.1, 0.5, 3);
        el.display.style.fontSize = `calc(clamp(96px, 18vw, 320px) * ${fontScale})`;
      });
      el.smaller.addEventListener('click', () => {
        fontScale = clamp(fontScale - 0.1, 0.5, 3);
        el.display.style.fontSize = `calc(clamp(96px, 18vw, 320px) * ${fontScale})`;
      });

      el.toggleMenu.addEventListener('click', () => {
        const hidden = el.header.classList.toggle('hidden');
        el.wrapper.classList.toggle('menu-hidden', hidden);
        el.toggleMenu.textContent = hidden ? 'Show menu' : 'Hide menu';
      });

      const keys = [
        'min',
        'max',
        'interval',
        'noRepeat',
        'audio',
        'fullscreen',
      ];
      function save() {
        const data = Object.fromEntries(
          keys.map((k) => [
            k,
            el[k].type === 'checkbox' ? el[k].checked : el[k].value,
          ])
        );
        try {
          localStorage.setItem('rnd-settings', JSON.stringify(data));
        } catch (e) {}
      }
      function load() {
        try {
          const s = JSON.parse(localStorage.getItem('rnd-settings') || '{}');
          for (const k of keys) {
            if (k in s) {
              if (el[k].type === 'checkbox') el[k].checked = !!s[k];
              else el[k].value = s[k];
            }
          }
        } catch (e) {}
      }
      keys.forEach((k) =>
        el[k].addEventListener(
          el[k].type === 'checkbox' ? 'change' : 'input',
          save
        )
      );
      load();

      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          if (timer) stop();
          else start();
        }
      });
    </script>
  </body>
</html>
